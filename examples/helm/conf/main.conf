<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>
<filter>
  @type parser
  key_name log
  reserve_data true
  hash_value_field app_log
  <parse>
    @type multi_format
    @include patterns/*.conf
    <pattern>
      format json
    </pattern>
    <pattern>
      format none
    </pattern>
  </parse>
</filter>
<filter>
  @type record_transformer
  enable_ruby true
  remove_keys log
  renew_record true
  <record>
    pod_name ${record.dig( "kubernetes", "pod_name")}
    host ${record.dig( "kubernetes", "host")}
    container_name ${record.dig( "kubernetes" , "container_name")}
    namespace_name ${record.dig( "kubernetes" , "namespace_name" )}
    app_log ${record["app_log"]}
  </record>
</filter>
<match **>
  @type coralogix
  privatekey "#{ENV['PRIVATE_KEY']}"
  appname "#{ENV['APP_NAME']}"
  subsystemname "#{ENV['SUB_SYSTEM']}"
  is_json true
</match>
